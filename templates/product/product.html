{% extends 'home_base.html' %}
{% load crispy_forms_filters %}
{% load i18n %}
{% load product_extras %}
{% load crispy_forms_tags %}
{% block title %}{% translate "فروشگاه اینترنتی میشاپ" %}{% endblock %}
{% block head %}

    <style>
        body {
            background-color: white !important;
            height: 100% !important;
        }
    </style>

{% endblock %}
{% block content %}

    <div id="product-images-modal" class="modal fade" role="dialog" style="margin-top: 10%!important;">
        <div class="modal-dialog">

            <div class="modal-content">
                <div class="modal-header-custom p-5 rounded-top">
                    <h4 class="modal-title">عکس های محصول</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
                <div class="modal-body">
                    <div class="w3-content w3-display-container" id="product-images-modal-body">


                    </div>
                </div>
            </div>

        </div>
    </div>
    <input type="hidden" id="products-images-url" data-url="{% url 'product_api:product-images-api' %}">
    <input type="hidden" id="product-price-by-property-url"
           data-url="{% url 'product_api:product-price-by-property-api' %}">
    <input type="hidden" id="product-price-by-color-url"
           data-url="{% url 'product_api:product-price-by-color-api' %}">
    <input type="hidden" id="product-price-by-color-and-property-url"
           data-url="{% url 'product_api:product-price-by-color-and-property-api' %}">
    {% with product_data=product.get_all_info %}
        <div class="row under-nav justify-content-center bg-white" id="test">
            <div class="col-10">
                <div class="row">

                    <div class="col-4 text-center" style="width: 20rem;">
                        <div>
                            <img class="p-2" src="{{ product_data.images.0.image.url }}" alt=""
                                 style="object-fit: scale-down; height: 100%; width: 70%;">
                        </div>

                        <div>
                            <div>
                                <a href="" id="other-product-images" onclick="get_product_images({{ product.id }})">
                                    {% for other_image in product.get_images_thumbnail %}
                                        <img class="p-2 mini-product-images" src="{{ other_image }}" alt="">
                                    {% endfor %}
                                    <span>دیدن عکس ها</span>

                                </a>
                            </div>
                        </div>

                    </div>
                    <div class="col-8 bg-white">
                        <div class="row"><h5>{{ product_data.product.name }}</h5></div>

                        <div class="row h-100">
                            <div class="col-8 text-right border-top">
                                <div id="product-colors">
                                    {% with colors=product.check_colors %}
                                        {% with quantities=product.check_quantity %}
                                            {% if colors.0 and colors.1 != 0 %}
                                                <ul class="non-style-list mt-4">
                                                    <li><p>رنگ ها</p></li>
                                                    <li>
                                                        <ul class="d-flex non-style-list">
                                                            {% for color in colors.1 %}
                                                                <li><a href="" class="colors mr-2"
                                                                       {% if forloop.counter == 1 %}id="color-active"{% endif %}
                                                                       data-key="{{ color.id }}"
                                                                       onclick="get_price_base_of_color_and_property($('#property-active'), $(this), {{ product.id }})">
                                                                    <span class="circle"
                                                                          style="background-color: {{ color.color }};">   </span>
                                                                </a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </li>
                                                </ul>
                                            {% endif %}
                                        {% endwith %}
                                        </div>
                                        <div>
                                        {% with quantities=product.check_quantity %}
                                            {% if quantities.0 and quantities.1 != 0 %}
                                                <ul class="non-style-list mt-4">
                                                    <li><p>{{ product.factor_property.name }}</p></li>
                                                    <li>
                                                        <ul class="non-style-list">
                                                            {% for quantity in quantities.1 %}
                                                                <li class="m-3">
                                                                    <a href="" class="properties"
                                                                       {% if forloop.counter == 1 %}id="property-active"{% endif %}
                                                                       onclick="get_price_base_of_color_and_property($(this), $('#color-active'), {{ product.id }})"
                                                                       data-key="{{ quantity.id }}">{{ quantity.value }}</a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </li>
                                                </ul>
                                            {% endif %}
                                        {% endwith %}
                                    {% endwith %}
                                    </div>
                                <ul class="text-right pt-5 product-properties">
                                    {% for property in product.get_top_3_properties %}

                                        <li class="m-4">{{ property.property.name }}: {{ property.description }}</li>

                                    {% endfor %}
                                </ul>
                                {% if product.category.name == 'تلفن همراه' %}
                                    <div class="meshop-warnings mt-5">

                                        <p>
                                            <span><i class="fa fa-exclamation-circle text-secondary"
                                                     aria-hidden="true"></i></span>
                                            هشدار سامانه همتا: در صورت انجام معامله، از فروشنده کد فعالسازی را گرفته و
                                            حتما
                                            در حضور ایشان، دستگاه را از طریق #7777*، برای سیمکارت خود فعالسازی نمایید.
                                            آموزش
                                            تصویری در آدرس اینترنتی hmti.ir/06
                                            امکان برگشت کالا در گروه موبایل با دلیل "انصراف از خرید" تنها در صورتی مورد
                                            قبول
                                            است که پلمپ کالا باز نشده باشد.</p>
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-4 price-side rounded">
                                {% with guarantee=product.check_for_guarantee %}
                                    {% if guarantee %}

                                        <div class="text-center d-flex mt-5 mb-4">
                                            <div><i class="fa fa-shield mt-2 ml-3 mr-1" aria-hidden="true"
                                                    style="font-size: 180%"></i></div>
                                            <div><h5>{{ guarantee.description }}</h5></div>
                                        </div>
                                        <span class="sep-border"></span>
                                    {% endif %}
                                {% endwith %}


                                {% if product.check_all_quantity.1 != 0 %}
                                    <div id="quantity" class="text-center d-flex mt-4 mb-4">
                                        <div>
                                            <i class="fa fa-check-square-o mt-2 ml-3" aria-hidden="true"
                                               style="font-size: 170%"></i>
                                        </div>
                                        <div>
                                            <h5>موجود در انبار میشاپ</h5>
                                        </div>
                                    </div>
                                    <span class="sep-border"></span>

                                {% endif %}

                                <div id="price" class="mt-3 mb-3">
                                    {% with quantity=product.check_all_quantity %}
                                        {% if quantity.1 != 0 %}
                                            {% with product_price=product.check_properties %}
                                                {% if quantity.0 %}

                                                    <div class="mt-2">
                                                        {% if product.productdiscount %}
                                                            <div class="d-flex justify-content-end"><strike
                                                                    style="font-size: 85%"><h4 id="base-price">
                                                                {{ product.calc_final_price_with_default_properties.3|price_format }}</h4>
                                                            </strike>
                                                                <p class="p-2 m-2"
                                                                   style="font-size: 90%; background-color: red; color: white; border-radius: 20px;">{{ product.calc_final_price_with_default_properties.2|en_to_fa }}%</p>
                                                            </div>
                                                            <div>
                                                                <h3 id="price-with-discount"> {{ product.calc_final_price_with_default_properties.1|price_format }}<span
                                                                        class="m-2 mr-3"
                                                                        style="font-size: 70%!important;">تومان</span>
                                                                </h3>
                                                            </div>
                                                        {% else %}
                                                            <h3 id="base-price">
                                                                {{ product.calc_final_price_with_default_properties.1|price_format }}<span
                                                                    class="m-2"
                                                                    style="font-size: 70%!important;">تومان</span>
                                                            </h3>
                                                        {% endif %}
                                                    </div>

                                                {% else %}
                                                    <div>
                                                        {% if product.productdiscount %}
                                                            <div class="d-flex justify-content-end"><strike
                                                                    style="font-size: 85%"><h4 id="base-price">
                                                                {{ product_price.0|price_format }}</h4></strike>
                                                                <p class="p-2 m-2"
                                                                   style="font-size: 90%; background-color: red; color: white; border-radius: 20px;">{{ product.calc_final_price.2|en_to_fa }}%</p>
                                                            </div>

                                                            <div>
                                                                <h3 id="price-with-discount"> {{ product.calc_final_price.1 }}<span
                                                                        class="m-2"
                                                                        style="font-size: 70%!important;">تومان</span>
                                                                </h3>
                                                            </div>
                                                        {% else %}
                                                            <h3 id="base-price">
                                                                {{ product_price.0|price_format }}<span class="m-2"
                                                                                                        style="font-size: 70%!important;">تومان</span>
                                                            </h3>
                                                        {% endif %}

                                                    </div>

                                                {% endif %}
                                            {% endwith %}
                                            <span class="sep-border"></span>
                                            <div id="add-to-cart" class="m-5 text-center ">
                                                <button onclick="
                                                        {% if not user.is_authenticated %}add_to_cart_on_local({{ product.id }})
                                                        {% else %}add_cart_to_database({{ product.id }}){% endif %}"
                                                        class="btn btn-rounded btn-danger w-75 p-3">افزودن به سبد خرید
                                                </button>
                                            </div>
                                        {% else %}
                                            موجود نیست
                                        {% endif %}
                                    {% endwith %}
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>



    {% endwith %}
    <div class="justify-content-center row" style="margin-top: 5%">

        <div class="col-10 bg-danger rounded">
            <div class="text-right text-white">
                <h5>محصولات مرتبط</h5>
            </div>

            {% if other_products %}

                <div class="d-flex justify-content-center">
                    {% for product in other_products %}
                        <a class="product-a-container" href="{% url 'product:product-detail' product.id %}">
                            <div class="card text-right m-3" style="width: 17rem">
                                <div style="height: 15rem;" class="text-center">
                                    <img class="card-img-top" src="{{ product.get_first_image.image.url }}"
                                         style="object-fit: scale-down; height: 100%; width: 100%" alt="product image">
                                </div>
                                <div class="card-body">
                                    <p class="card-title">{{ product.name|short_description }}</p>
                                    <div class="text-left price">
                                        {% if product.calc_final_price_with_default_properties.0 %}
                                            <div class="d-flex justify-content-end">
                                                <strike class="card-text m-2"
                                                        style="font-size: 85%">{{ product.calc_final_price_with_default_properties.3|price_format }} </strike>
                                                <p class="p-2"
                                                   style="font-size: 90%; background-color: red; color: white; border-radius: 20px;">{{ product.calc_final_price_with_default_properties.2|en_to_fa }}%</p>
                                            </div>
                                            <p class="card-text">{{ product.calc_final_price_with_default_properties.1|price_format }}
                                                تومان </p>
                                        {% else %}

                                            <p class="card-text m-2">{{ product.calc_final_price_with_default_properties.1|price_format }}
                                                تومان </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </a>
                    {% endfor %}

                </div>
                <div class="text-center">
                    {% if other_products.has_other_pages %}
                        <div class="pagination d-flex justify-content-between">

                            {% if other_products.has_previous %}
                                <div><a class="btn-white rounded"
                                        style="text-decoration: none; font-size: 220%!important; background-color: white!important;"
                                        href="?page={{ other_products.previous_page_number }}">&laquo;</a></div>
                            {% else %}
                                <div class="btn-white rounded disabled"><span class="rounded"
                                                                              style="font-size: 220%!important; background-color: #a79e9e!important;">&laquo;</span>
                                </div>
                            {% endif %}
                            {% if other_products.has_next %}
                                <div>
                                    <a style="font-size: 220%!important; background-color: white!important; text-decoration: none"
                                       class="btn-white rounded" href="?page={{ other_products.next_page_number }}">&raquo;</a>
                                </div>
                            {% else %}
                                <div class="btn-white rounded disabled"><span class="rounded"
                                                                              style="font-size: 220%!important; background-color: #a7a3a3!important;">&raquo;</span>
                                </div>
                            {% endif %}

                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>

    </div>
{% endblock %}

